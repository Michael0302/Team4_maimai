
@{
    ViewBag.Title = "backstageIndex";
}

<h2>backstageIndex</h2>


    <style>
        .fade {
            opacity: 1;
        }
    </style>

    <div class="container">
        <div class="row">
            <div class="col-2" id="backstage">
                <a class="btn btn-primary mb-3 btn-block" data-toggle="collapse" href="#member_P" role="button"
                   aria-expanded="false" aria-controls="member_P">會員管理</a>
                <div class="collapse mb-3" id="member_P" data-parent="#backstage">
                    <a class="d-block btn" onclick="getMemberList()">所有會員</a>
                    <a class="d-block btn" onclick="getAdminLlist()">管理員</a>
                </div>

                <a class="btn btn-primary mb-3 btn-block" data-toggle="collapse" href="#order_P" role="button"
                   aria-expanded="false" aria-controls="order_P">訂單管理</a>
                <div class="collapse mb-3" id="order_P" data-parent="#backstage">
                    <a class="d-block btn" onclick="getOrderList()">所有訂單</a>
                    <a class="d-block btn" onclick="getOrderList()">已完成訂單</a>
                    <a class="d-block btn" onclick="getOrderList()">未完成訂單</a>

                </div>
            </div>

            <div class="col-10">
                <div id="show">
                </div>

                <div class="modal fade" id="editMember" tabindex="-1" role="dialog" aria-labelledby="editMemberTitle"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editMemberTitle">會員資訊</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body" id="editMemberbody">

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                                <button type="button" class="btn btn-danger" onclick="editMemberLevel()">儲存</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="editOrder" tabindex="-1" role="dialog" aria-labelledby="editOrderTitle"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editOrderTitle">商品資訊</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body" id="editOrderbody">

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>


    </div>





    @*<script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
            integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
            integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
            crossorigin="anonymous"></script>*@
<script>

        function getMemberList() {
            $.ajax({
                url: "@Url.Action("getMemberList_P", "backstage")",
                type: "GET",
                success: function (memberList) {
                    $("#show").html("<div class='d-flex justify-content-center' id='search'></div> <table class='table table-hover'><thead class='table-dark'><tr id='showTh'> <th>帳號</th><th>姓名</th><th>會員等級</th><th>信箱</th><th>城市</th><th></th></tr></thead> <tbody id='showList'></tbody></table>");
                    $(memberList).each(function(index, item){
                        $("#showList").append(`<tr><td>${item.userAccount}</td><td>${item.Name}</td><td>${item.userLevel}</td><td>${item.email}</td><td>${item.city}</td><td><button type='button' class='btn btn-primary' data-toggle='modal' onclick='getMember(${item.UserID})' data-target='#editMember'>查看</button></td></tr>`);
                    });
                }
            })
        }

        function getMember(id) {
            $.ajax({
                url: "@Url.Action("getMember_P", "backstage")",
                data: {id:id },
                type: "GET",
                success: function (member) {
                    $(member).each(function (index, member) {
                        var birthdayMilliseconds = parseInt(member.birthday.replace(/\D/igm, ""));
                        var biryear = new Date(birthdayMilliseconds).getFullYear();
                        var birmonth = new Date(birthdayMilliseconds).getMonth()+1;
                        var birdate = new Date(birthdayMilliseconds).getDate();
                        $("#editMemberbody").html(`<form><div class='d-flex justify-content-center'><label>會員編號<input name="UserID" class='form-control' type='text' value = "${member.UserID}" readonly/><label>會員帳號<input name="userAccount" class='form-control' type='text' value = "${member.userAccount}" readonly/><label>城市<input name="city" class='form-control' type='text' value = "${member.city}" readonly/><label>地址<input name="address" class='form-control' type='text' value = "${member.address}" readonly/><label>信箱<input name="email" class='form-control' type='text' value = "${member.email}" readonly/><label>電話<input name="phoneNumber" class='form-control' type='text' value = "${member.phoneNumber}" readonly/><label>姓名<input class='form-control' type='text' value = "${member.Name}" readonly/><label>生日<input class='form-control' name="birthday" type='text' value = "${biryear}-${birmonth}-${birdate}" readonly/><label>身分證字號<input class='form-control' type='text' name="identityNumber" value = "${member.identityNumber}" readonly/><label>大頭貼<input class='form-control' type='text' name="profileImg" value = "${member.profileImg}" readonly/><label>會員等級<select id="inputState" class="form-control" name="userLevel">
                            <option value="${member.userLevel}">${member.userLevelString}</option>
                            <option value="1">管理員</option>
                            <option value="2">優質會員</option>
                            <option value="3">一般會員</option>
                            </select><label>總評分<input class='form-control' type='text' name="totalStarRate" value = "${member.totalStarRate}" readonly/><label>自我介紹<textarea class='form-control' rows="5" cols="30"  style="resize:none" name="selfDescription" readonly>${member.selfDescription}</textarea><input type="hidden" name="userPassWord" value="${member.userPassWord}"/><input type="hidden" name="firstName" value="${member.firstName}"/><input type="hidden" name="lastName" value="${member.lastName}"/></div</form>`)

                    })
                }
            })
    }

    function getAdminLlist() {
        $.ajax({
            url: "@Url.Action("getAdminList_P", "backstage")",
            type: "GET",
            data: {userLevel:"1"},
            success: function (memberList) {
                $("#show").html("<div class='d-flex justify-content-center' id='search'></div> <table class='table table-hover'><thead class='table-dark'><tr id='showTh'> <th>帳號</th><th>姓名</th><th>會員等級</th><th>信箱</th><th>城市</th><th></th></tr></thead> <tbody id='showList'></tbody></table>");
                $(memberList).each(function (index, item) {
                    $("#showList").append(`<tr><td>${item.userAccount}</td><td>${item.Name}</td><td>${item.userLevel}</td><td>${item.email}</td><td>${item.city}</td><td><button type='button' class='btn btn-primary' data-toggle='modal' onclick='getMember(${item.UserID})' data-target='#editMember'>查看</button></td></tr>`);
                });
            }
        })
    }

    function editMemberLevel() {
        var form = document.querySelector("form");
        var formdata = new FormData(form);
        $.ajax({
            url: "@Url.Action("editUserLevel_P", "backstage")",
            type: "POST",
            data: formdata,
            processData: false,
            contentType: false,
            success: function (order) {
                alert("儲存成功");
                $('#editMemberbody').modal('hide')
                    getMemberList();
                }
            })
        }

        function getOrderList() {
            $.ajax({
                url: "@Url.Action("getOrderList_P", "backstage")",
                type: "GET",
                success: function (orderList) {
                    $("#show").html("<div class='d-flex justify-content-center' id='search'></div> <table class='table table-hover'><thead class='table-dark'><tr id='showTh'> <th>訂單編號</th><th>賣方</th><th>買方</th><th>價錢</th><th>訂單狀態</th></tr></thead> <tbody id='showList'></tbody></table>")
                    $("#showList").html(`<tr><td>${orderList.OrderID}</td><td>${orderList}</td><td><button type='button' class='btn btn-primary' onclick='getOrder()'>查看</button></td></tr>`)
                }
            })
        }

        function getOrder() {
            $.ajax({
                url: "backstage.html",
                type: "GET",
                success: function (order) {
                    $("#show").html("<div class='d-flex justify-content-center' id='search'></div> <table class='table table-hover'><thead class='table-dark'><tr id='showTh'> <th>商品名稱</th><th>價錢</th><th>數量</th><th>建立時間</th><th>建立者</th></tr></thead> <tbody id='showList'></tbody></table><div class='d-flex justify-content-center'><a class='btn btn-danger'>刪除此訂單</a></div>")
                    $("#showList").html("<tr><td><button type='button' class='btn btn-primary' data-toggle='modal' onclick='getOrderDetail()' data-target='#editOrder'>查看</button></td></tr>")
                }
            })
        }

        function getOrderDetail() {
            $.ajax({
                url: "backstage.html",
                type: "GET",
                success: function (order) {
                    $("#editOrderbody").html("<div class='d-flex justify-content-center'><label>商品編號<input class='form-control' type='text'/><label>商品名稱<input class='form-control' type='text'/><label>商品描述<input class='form-control' type='text'/><label>商品照片<input class='form-control' type='text'/><label>建立者<input class='form-control' type='text'/><label>數量<input class='form-control' type='text'/><label>價錢<input class='form-control' type='text'/><label>標籤<input class='form-control' type='text'/><label>建立時間<input class='form-control' type='text'/></div>")
                }
            })
         }




</script>
