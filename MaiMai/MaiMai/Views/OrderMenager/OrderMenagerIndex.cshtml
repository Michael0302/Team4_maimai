
@{
    ViewBag.Title = "OrderMenagerIndex";
}


<div class="container" style="margin-top:80px;">
    <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-nonPay-tab" data-toggle="tab" href="#nav-nonPay" role="tab" aria-controls="nav-nonPay" aria-selected="true">待結帳訂單</a>

            <a class="nav-item nav-link" id="nav-process-tab" data-toggle="tab" href="#nav-process" role="tab" aria-controls="nav-process" aria-selected="false">處理中訂單</a>
            <a class="nav-item nav-link" id="nav-past-tab" data-toggle="tab" href="#nav-past" role="tab" aria-controls="nav-past" aria-selected="false">歷史訂單</a>
        </div>
    </nav>


    @*================================以上導覽列============================================*@
    <div class="tab-content" id="nav-tabContent">

        @*================================以下待付款列表============================================*@

        <div class="tab-pane fade show active" id="nav-nonPay" role="tabpanel" aria-labelledby="nav-nonPay-tab"> @*div tab*@ 

            <table class="table table-striped" >
                <thead>
                    <tr>
                        <th scope="col">訂單編號</th>
                        <th scope="col">建立時間</th>
                        <th scope="col">總金額</th>
                        <th scope="col"></th>

                    </tr>
                </thead >
                <tbody id="tbody">
                  
                </tbody>
            </table>



        </div>



        @*========================================待付款訂單END=======================================*@
        @*========================================處理中訂單START=======================================*@
        <div class="tab-pane fade" id="nav-process" role="tabpanel" aria-labelledby="nav-process-tab">...</div>

        @*========================================處理中訂單end=======================================*@
        @*========================================歷史訂單START=======================================*@
        <div class="tab-pane fade" id="nav-past" role="tabpanel" aria-labelledby="nav-past-tab">...</div>

        @*========================================處理中訂單START=======================================*@
    </div> @*//END OF ORDER LIST*@

</div> @*// END OF CONTAINER*@


<script>

        function getCookie(cookieName) {
            var name = cookieName + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1);
                if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
            }
            return "";

    } // end of getCookie 


    $(function () {
        
        var test = getCookie('LoginID');
        console.log(test);
        console.log(typeof test);

        if (test == "") {
            return window.location.href = `/Members/Login`;
        }

        $.ajax({
            url: "/OrderMenager/getNonPayOrderList",
            type: "GET",
            data: { 'userid': test },
            success: function (response) {
               
                $(response).each(function (i, item) {
                    var Milliseconds = parseInt(item.createdTime.replace(/\D/igm, ""));
                    var year = new Date(Milliseconds).getFullYear();
                    var month = new Date(Milliseconds).getMonth() + 1;
                    var date = new Date(Milliseconds).getDate();
                    $('#tbody').append(`
                        <tr onclick=showDetail(this,${i})>
                        <th scope="row">${item.OrderId}</th>
                        <td>${ year } - ${ month } - ${ date }</td>
                        <td>${item.price}</td>
                        <td><a class= "btn btn-info" href="#"> 結帳</td>
                        </tr>`)

                })
            }
        })

    }) // end of doucument ready

    function showDetail(elem, i) {

    }

</script>